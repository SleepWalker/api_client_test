<!DOCTYPE html>
<!--[if lt IE 8]><html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]><html class="no-js ie7 oldie" lang="en"><![endif]-->
<!--[if IE 8]><html class="no-js ie8 oldie" lang="en"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>MATCH KILLAR!</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="foundation.css">
</head>
  <body ng-app='matchApp'>
  <nav class="top-bar" data-topbar>
    <ul class="title-area">
      <li class="name">
        <h1><a href="#">Hot Date!</a></h1>
      </li>
    </ul>

    <section class="top-bar-section">
      <ul class="left">
        <li class="active"><a href="#login">Login</a></li>
        <li><a href="#signup">Signup</a></li>
        <li><a href="#list">List my dates!</a></li>
      </ul>
    </section>
  </nav>
  <div ng-view></div>
    <script type="text/ng-template" id='view/login'>
      <div id="login">
          <div class="row">
            <div class="column small-offset-1 small-10 large-offset-2 large-8">
              <h1>Login</h1>
              {{ user }}
              <form ng-submit='handleLogin(user)' class="small-8">
                <input ng-model='user.login' name="login" type="text" placeholder="enter your login">
                <input ng-model='user.password' name="password" type="password" placeholder="enter your password">
                <input type="submit" value="Log me in" class="button">
                <a href="#/signup" class="button secondary">Sign me up</a>
              </form>
            </div>
          </div>
      </div>
    </script>
    <script type="text/ng-template" id='view/signup'>
      <div id="signup">
        <div class="row">
          <div class="column small-offset-1 small-10 large-offset-2 large-8">
            <h1>Signup</h1>
            <form ng-submit='handleSignup(user)' class="small-8">
              <input ng-model='user.login' name="login" type="text" placeholder="enter your login">
              <!-- <small class="error">Something went wrong!</small> -->
              <input ng-model='user.email' name="email" type="email" placeholder="enter your email">
              <input ng-model='user.password' name="password" type="password" placeholder="enter your new password">
              <input ng-model='user.passwordConfirmation' name="passwordConfirmation" type="password" placeholder="retype it">
              <input type="submit" value="Let me in!" class="button">
              <a href="#/login" class="button secondary">Nah, I do have an account already.</a>
            </form>
          </div>
        </div>
      </div>
    </script>
    <script type="text/ng-template" id='view/list'>
      <div id="list">
        <ul class="small-block-grid-3">
          <li ng-repeat='user in users' >
            <div class="person">
              <a class='url n' href="#show-full/{{user._id}}">
              <img src="{{user.avatar}}" alt="{{user.login }} avatar">
                {{user.login}}</a>
            </div>
          </li>
        </ul>
      </div>
    </script>

    <script type="text/ng-template" id='view/show-full'>
      <div id="show-full">
        <div>
        <img src="ajax-loader.gif" alt="AJAX loader animation">
        <h2>Mr. Know-it-all, I</h2>
        <section>
          <h3>Location</h3>
          Street: 1212 mullholand drive, hollywood, LA, 12312
        </section>
        <section>
          <h3>Connect with him!</h3>
          <a href="mailto:knowitall@whitehouse.gov">knowitall@whitehouse.gov</a>

          <br/>
          <a href="tel:38(098)#102">38(098)9991613</a>
        </section>
        </div>
      </div>
    </script>
    <!--[if lt IE 7]><script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script><script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script><![endif]-->
   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
   <script src='bower_components/angular/angular.js'></script>
   <script src='bower_components/angular-route/angular-route.js'></script>
   <script>
   angular.module('matchApp', ['ngRoute'])
    .config(function($routeProvider){
      $routeProvider
        .when('/login',{
          templateUrl: 'view/login',
          controller: 'LoginCtrl'
        })
        .when('/signup',{
          templateUrl: 'view/signup',
          controller: 'SignupCtrl'
        })
        .when('/list',{
          templateUrl: 'view/list',
          controller: 'ListCtrl'
        })
      $routeProvider.otherwise('/login')
    })
    .constant('API_URL', 'http://www.jscacourse.co.vu:3000')
    .controller('ListCtrl', function($scope, $http, API_URL) {
      $scope.users = [];
      $http.get(API_URL + '/user').then(function(response){
        $scope.users = response.data
      })
    })
    .controller('SignupCtrl', function($scope, $http, API_URL, $rootScope) {
      $scope.user = {}
      console.log($rootScope.token)
      $scope.handleSignup = function(user, $event) {
        $http.post(API_URL + '/signup', user).then(
          function(response){
            $rootScope.token = JSON.parse(JSON.parse(response.data)).token
          },
          function(error){console.log('error ', error)}
        )
      }
    })
    .controller('LoginCtrl', function($scope, $http, API_URL, $rootScope){
      $scope.user = {}
      console.log($rootScope.token)
      $scope.handleLogin = function(user, $event) {
        $http.post(API_URL + '/signin', user).then(
          function(response){
            $rootScope.token = JSON.parse(JSON.parse(response.data)).token
          },
          function(error){console.log('error ', error)}
        ).then(function(){console.log('$rootScope.token ', $rootScope.token)})
      }
      return 0
    })
   </script>
  </body> 
</html>

<!-- <div id="your section">
      <header>
        <a href="logout">Log out</a>
      </header>
      <div id="main" role="main">

      </div>
      <footer>

      </footer>
    </div> -->





